{"ID":5836,"Author":{"Name":"dlintw","ID":0,"FullName":"","Gravatar":"86187a52f1e2f64890194d0451748ce5"},"Title":"網樂通設定多重開機到 shairport wheezy 版本","Description":"\u003cdiv class=\"content\"\u003e\u003cp\u003e解壓縮 shairport dd 檔的 USB 第一個磁區的 txz 檔\u003cbr/\u003e\n首先將 shairport的 rootfs 解壓縮到某個分割區, 這裡以 /dev/sda9 為例\u003c/p\u003e\n\n\u003cp\u003e設 sh4twbox 網樂通原本 /dev/sda2 的 /etc/fstab 內容如下\u003cbr/\u003e\n/dev/sda1 /boot auto noauto,noatime,defaults 0 0\u003cbr/\u003e\n/dev/sda9 /mnt/shair ext4 noauto,noatime,defaults 0 0\u003cbr/\u003e\n連上磁碟\u003cbr/\u003e\nmount /mnt/shair\u003cbr/\u003e\nmount /mnt/boot\u003c/p\u003e\n\n\u003cp\u003e要將 shair/boot 裡的 vmlinux.ub 放到 /boot, 但是檔名要分開, 並看一下\u003cbr/\u003e\nmv /boot/vmlinux.ub /boot/vmlinux.sh4twbox \u003cbr/\u003e\ncp /mnt/shair/boot/vmlinux.ub /boot/vmlinux.ub\u003c/p\u003e\n\n\u003cp\u003e參考 /mnt/shair/boot/uboot.sh 修改自己的 /mnt/boot/uboot.sh, 重點:\u003cbr/\u003e\n1. 將 sda2 改為 sda9\u003cbr/\u003e\n2. 將 120M 改為 256M\u003cbr/\u003e\n3. 將 vmlinux.ub 改為 vmlinux.shair\u003c/p\u003e\n\n\u003cp\u003e重開機看看, 重開前切到 TTL console 看畫面\u003cbr/\u003e\nreboot\u003c/p\u003e\n\n\u003ch1\u003e當機處理\u003c/h1\u003e\n\n\u003cp\u003e使用非 vmlinux.ub 檔名會當, 用救援碟救一下(此處以 linux 為例)\u003cbr/\u003e\npmount sdb1\u003cbr/\u003e\nmv /media/sdb1/auto.tag /media/sdb1/auto.tag.old\u003cbr/\u003e\npumount sdb1\u003c/p\u003e\n\n\u003cp\u003eUSB插到網樂通,壓住 RESET, 再開機, RESET 再放開, 同時觀察 console (TTL)\u003cbr/\u003e\n注意使用 sh4twbox 確認是否正確由外部開機, 重點是 /dev/sda2 ext3 (ext3)\u003cbr/\u003e\n同時此時網樂通應該是紅燈,有人反應 RAM 還是沒有升成 256M, 這是因為\u003cbr/\u003e\nsh4twbox 0.7 使用 SMIT 公司內定的 120M 設定, 可以自己調大為 256M 開機\u003c/p\u003e\n\n\u003cp\u003e接著要改內部USB(DOM)的第一個分割區裏面的 uboot.sh,並將檔名改短\u003cbr/\u003e\n目前的 kernel 會將DOM 認為是 sdb, 所以要改的是 sdb1\u003cbr/\u003e\nmount /dev/sdb1 /mnt/sdb1\u003cbr/\u003e\ncd /mnt/sdb1 ; mv vmlinux.xxx vmlinux.ub ; vi uboot.sh\u003cbr/\u003e\nsync ; umount /mnt/sdb1\u003c/p\u003e\n\n\u003cp\u003e改完關機,拔除USB,開機\u003cbr/\u003e\npoweroff\u003c/p\u003e\n\n\u003cp\u003e改完後開機成功, 看起來 rootdelay 應該也可以改為 0, 再看看\u003cbr/\u003e\n插上 USB keyboard 也可以看到 console\u003cbr/\u003e\n但是開機後是紫燈(因為我沒有直接用 sh4twbox 安裝)\u003cbr/\u003e\nvi /etc/rc.local \u003cbr/\u003e\n最後一行加上燈號設為藍燈即可\u003cbr/\u003e\nledctl.sh blue\u003cbr/\u003e\n再拿掉一些 uboot 除錯動作, 可以開機更快些\u003c/p\u003e\n\u003c/div\u003e","Time":"2013-10-09T23:49:50Z","Tags":["Linux","bash","xterm"]}